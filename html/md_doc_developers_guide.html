<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>astrotypes: developers_guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">astrotypes
   &#160;<span id="projectnumber">0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">developers_guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="dev_guide"></a></p><h1>Developers Guide</h1>
<h2>Dependencies</h2>
<p>Do not introduce any new dependencies on any other product without consultation</p>
<h2>Build Products</h2>
<p>The product is a header only library, but the project will build a number of unit tests to support this header as well as some examples and generated documentation. It is not necessary to build these unit tests, documentation, or examples to use the header, but all develoipment should ensure that all these unit tests pass. (i.e. all executables triggered by make test should PASS)</p>
<h1>Repository</h1>
<h2>Workflow and Branches</h2>
<ul>
<li>Never work directly on the master branch - this is the "stable release" and is tightly controlled<ul>
<li>The master shall compile and pass all unit tests at all times.</li>
<li>Commits to the master must only be done after code review and from a working dev branch</li>
</ul>
</li>
<li>devs should keep their own branch in sync with the dev branch.<ul>
<li>The dev shuold compile and pass all unit tests. Any build breaks should receive top priority.</li>
</ul>
</li>
<li>Only merge from a feature branch that is already synced with the dev branch.<ul>
<li>Commits to the dev should usually only be done after code review and from a working feature branch</li>
<li>use the github merge request feature for feature-&gt;dev branch merges</li>
</ul>
</li>
</ul>
<h2>Repository Structure</h2>
<p>The astrotypes library is envisioned to support languages used in astro development. Each language has its own subdirectory below src. Each language directory will have specifics to the language but will usually contain:</p>
<p>cmake : specific files for configuring the build system to the specific language tools : useful things to aid the developer such as a class template generator doc : documentation &amp; doc templates, with the exception of the API doc of the classess. astrotypes : this is the actual src code. It may have a substructure e.g. for c++ </p><pre class="fragment">             astrotypes +
                     + &lt;module_name&gt; +                      In this directory only put header files that you wish exposed to module users
                                     + doc                  Add additional doxygen documentation for tutorials etc here.
                                     + examples             src code example uses
                                     + src                  All .cpp files for the library and internal headers
                                     + detail               All .cpp implementations details for template classes that cannot be precompiled
                                     + test_utils +         Include files for the supporting test library
                                                  + src     Implementation details (.cpp files) for the test library
                                                  + detail  Template implementation details for the test support library
                                     + test                 The unit test directory. Header files for unit tests live here
                                                  + src     Implementation details (.cpp files) for unit tests
</pre><p>astrotypes/test : the location of tests and any public headers for the astrotypes integration tests astrotypes/test/src : the location of all test implementation coded</p>
<h1>The Build System</h1>
<p>This project uses cmake as is build system. See the notes in the CMakeLists.txt file in the top directory</p>
<h2>Adding a src file/class</h2>
<ul>
<li>Each time you add a new class, in order for it to build you will need to add a reference to it in the appropriate CMakeLists.txt file (either in astrotypes/module_name/CMakeLists.txt or astrotypes/module_name/test_utils/CMakeLists.txt)<ul>
<li>place source names in alphabetical order when adding to variables</li>
</ul>
</li>
<li>You can use the class tool (in the tools directory) to autogenerate a suitable class template</li>
</ul>
<h2>Adding a submodule</h2>
<ul>
<li>To add a submodule use the SUBPACKAGE macro (see doc in cmake/subpackage.cmake). To simplify, the purpose of this macro is to add the submodules contribution to the lib_src_${arch} variables which are used to define the contents of the astrotypes libraries. (n.b ensure the variables defined in the submodule use PARENT_SCOPE qualifier)</li>
</ul>
<h2>Including a dependency in the build system</h2>
<ul>
<li>unless essential (and approved to be so) make the dependency optional, and off by default. Allow the ENABLE_&lt;feature&gt; flag to enable.</li>
<li>add a new file cmake file in the cmake directory for that product/feature and include this from cmake/dependencies.cmake</li>
<li>Stick to a standard convention for naming the product location. TODO - decide what these should be i.e. &lt;NAME&gt;_ROOT, &lt;NAME&gt;_INCLUDE_DIRECTORIES, &lt;NAME&gt;_LIBRARIES, FOUND_&lt;NAME&gt;</li>
<li>Test these can be overriden succesfully from the command line and non-system versions can be specified easily</li>
</ul>
<h1>Coding Conventions</h1>
<p>Coding conventions are used in this project to ensure conformity in style and to help reduce any of the very many pitfalls c++ programming can introduce, Remember that these are just general guidelines. Try and stick to them as much as possible, but there will always be cases where doing it differently is justified. Document these exceptions with comments in the code.</p>
<h2>Namespaces</h2>
<ul>
<li>all classes shall be in the <a class="el" href="namespacepss_1_1astrotypes.html">pss::astrotypes</a>::&lt;module_name&gt; or <a class="el" href="namespacepss_1_1astrotypes.html">pss::astrotypes</a>::&lt;module_name&gt;::test namespace as appropriate.</li>
<li>avoid using where possible "using namespace ..". Avoid completely in public header files.</li>
</ul>
<h2>Naming Conventions</h2>
<ul>
<li>class names shall start with a capital letter and be CamelCased</li>
<li>method and functions shall be all lower case, with word seperation with an "_" e.g. do_something()</li>
<li>variable and member names shall be all lower case</li>
<li>all members shall be prefixed with an underscore "_"</li>
<li><p class="startli">getters and setters should be overloads with the same function name e.g. ``` // getter ThingyType thingy() const;</p>
<p class="startli">// setter void thingy(ThingyType const&amp; thingy); ```</p>
</li>
</ul>
<h2>Indendation &amp; CRLF of source files</h2>
<ul>
<li>use 4 spaces instead of tab.</li>
<li>use LF in preference to CRLF</li>
<li>namespaces shall not be indented</li>
</ul>
<h2>C++ Files</h2>
<p>Each class shall have its own separate cpp and header file. The name of the file should be the same as the class with the .h or .cpp extension Do not mix two classes together in the same file. An exception to this rule can be made where there is a private Internal Implementation class unique to the class being implemented AND it is not confusing to do so.</p>
<ul>
<li>All classes must be in the pss, astrotypes namespace</li>
<li>Header files must start with. ``` #ifdef PSS_ASTROTYPES_&lt;MODULE_NAME&gt;_&lt;CLASS_NAME&gt;_H #define PSS_ASTROTYPES_&lt;MODULE_NAME&gt;_&lt;CLASS_NAME&gt;_H ... body of header #endif // PSS_ASTROTYPES_&lt;MODULE_NAME&gt;_&lt;CLASS_NAME&gt;_H ``` In the tool directory you will find a class template generator that you may find helpful. <h2>Documentation</h2>
</li>
</ul>
<ul>
<li>Add doxygen style comments for each method and each parameter in every public header file.</li>
<li>Think about adding an example of the use of each method</li>
<li>Document the bounds of any parameter</li>
<li>Document untested use cases/parameters (i.e. where you have not provided an explicit unit test)</li>
<li>Add comments as appropriate in the cpp file and non-public headers.</li>
</ul>
<h2>Constructors</h2>
<ul>
<li>Never use new inside a constructor parameter list e.g. ``` dodgy = MyClass(new BadThingToDo());. ``` This could easily lead to a memory leak if the constructor of MyClass should fail.</li>
<li>Do not create long lists of parameters with the same types. Use strong typeing as much as possible to get your compiler to do the debugging for you. e.g. thing(int x_dimension, int y_dimension, int subject_index) could become: thing( Dimension x, Dimension y, SubjectIndex i ); or even: thing( DimensionX x, DimensionY y, SubjectIndex i );</li>
<li>align commas in the initialiser list on seperate lines e.g. ```c++ MyClass(A a, B b) : _a(a) // indent : by 4 spaces on its own line , _b(b) // align comma under the : { } ```</li>
</ul>
<h2>Class Declarations</h2>
<ul>
<li>all members shall be prefixed with an underscore "_"</li>
<li>all members shall be made either private or protected as appropriate</li>
<li>indent private, protected, amd public keywords by 4 spaces</li>
<li>always use the override keyword when you inherit from a method</li>
<li>do not mix members, typdefs, or functions together, but keep them in their own public:, protected:, or private: blocks.</li>
<li>all public methods and typedef should be documented</li>
<li><p class="startli">header shall be ordered as much as possible as follows, each type in their own public/private/protected block: e.g. ```c++ class MyClass { public: // typdefs</p>
<p class="startli">public: // public methods before protected</p>
<p class="startli">protected: // protected methods before private</p>
<p class="startli">private: // private methods</p>
<p class="startli">protected: // protected members</p>
<p class="startli">private: // private members }; ```</p>
</li>
</ul>
<h2>Exceptions</h2>
<ul>
<li>Prefer exceptions, but use return codes where it is more appropriate</li>
<li>No exceptions to be propagated outside of its thread - think about passing it along with a std::exception_ptr.</li>
<li>Use std::exceptions as appropriate, or panda::Error if you want to add messages with runtime information.</li>
<li>If you need your own exceptions for some reason, try and avoid any memory allocation of the exception. i.e follow the std::exception model It should also be OK to inherit from panda::Error.</li>
</ul>
<h2>Unit Tests</h2>
<ul>
<li>gtest shall be used as the unit test framework</li>
<li>each class should have its own unit test suite which shall be in files &lt;CLASS_NAME&gt;Test.cpp and &lt;CLASS_NAME&gt;Test.h in the unit test directory</li>
<li>any common functionality should be considered for inclusion in the test utility library, and provded with appropriate headers and documentation</li>
<li>all unit tests should be verified to pass before making a merge reuest</li>
<li>unit test names shall follow the function naming convention of the c++ irrespective of whether it is implemented as a class or not</li>
<li>unit test groups shall be CamelCased e.g ``` TEST_F(MyTestGroup, test_something_really_well) ```</li>
<li>to run all the tests ``` make test ```</li>
<li>to run all the tests and generate a test coverage report (only in 'coverage' type builds) ``` make coverage_report_test ```</li>
</ul>
<h2>Using CUDA</h2>
<p>If CUDA is available and it has been explicitly activated in the build system, the ENABLE_CUDA flag will be set. Use this flag to ensure your code compiles and your unit tests run with or without CUDA availability.</p>
<p>Setting specific compile flags for subpackage products shall be done through the cuda_subpackage_compile macro: e.g.</p>
<p>cuda_subpackage_compile(${lib_src_cuda} OPTIONS "-arch compute_35")</p>
<h2>Extending std classes</h2>
<p>While this style guide requests CamelCase typedefs, there are cases where the standard convention is to use lower_case names for typedefs. This is true in the case of classes that extend or can be used in place of classes from the standard library (or as in the case of thrust, boost, etc. libraries that follow conventions from the standard library) that conform to specific concepts. Places where this is done should be clearly documented. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 11 2019 10:12:05 for astrotypes by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
