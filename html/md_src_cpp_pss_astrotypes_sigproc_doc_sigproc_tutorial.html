<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>astrotypes: sigproc_tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">astrotypes
   &#160;<span id="projectnumber">0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sigproc_tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sigproc"></a>
The Sigproc file format (FilterBank and TimeSeries)</h1>
<h2>Quick Start Example</h2>
<p>To read in any sigproc file you can use the FileReader class. This will autmoatically convert formats from/to TimeFrequecy or FrequencyTime formats as appropriate.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SigProc_8h.html">pss/astrotypes/sigproc/SigProc.h</a>&quot;</span></div>
<div class="line">sigproc::FileReader&lt;&gt; filterbank_file(<span class="stringliteral">&quot;my_filterbank_file.fil&quot;</span>);</div>
<div class="line">TimeFrequency&lt;uint8_t&gt; time_frequency;</div>
<div class="line"></div>
<div class="line"><span class="comment">// The ResizeAdapter resizes the time_frequency object according to the filterbank files parameters and file size</span></div>
<div class="line">filterbank &gt;&gt; ResizeAdapter&lt;units::Time, units::Frequency&gt;() &gt;&gt; time_frequency;</div>
</div><!-- fragment --><p> This will work equally with FrequencyTime types. Note that any corner turns will be done automatically by the streaming operators.</p>
<p>If you only want to resize the number of channels, then leave out the units::Time template parameter in the ResizeAdapter. e.g. </p><div class="fragment"><div class="line"><span class="comment">// read in the first 100 spectra</span></div>
<div class="line">TimeFrequency&lt;uint8_t&gt; time_frequency(DimensionSize&lt;units::Time&gt;(100));</div>
<div class="line">filterbank &gt;&gt; ResizeAdapter&lt;units::Frequency&gt;() &gt;&gt; time_frequency;</div>
</div><!-- fragment --><h3>Sigproc Headers</h3>
<p>The sigproc format has a header at the beginning of each file that describes the binary data in the rest of the file.</p>
<p>We can use the FileReader as above to read this in and then you can access it via the  header() method. If you want more control, you can use the headers streaming operators. e.g. </p><div class="fragment"><div class="line"><span class="keyword">using</span> astro = <a class="code" href="namespacepss_1_1astrotypes.html">pss::astrotypes</a>;</div>
<div class="line"></div>
<div class="line">std::ifstream in(<span class="stringliteral">&quot;my_file_name.fil&quot;</span>, std::ios::binary);</div>
<div class="line">astro::sigproc::Header header;</div>
<div class="line"></div>
<div class="line">in &gt;&gt; header;</div>
<div class="line"></div>
<div class="line"><span class="comment">// print human friendly verison of the header</span></div>
<div class="line">std::cout &lt;&lt; astro::sigproc::Header::Info() &lt;&lt; header;</div>
</div><!-- fragment --><p> This is how we do it in the sigproc_header executable in the examples folder.</p>
<div class="fragment"></div><!-- fragment --><h3>Reading in Sigproc Data</h3>
<p>Now we have all the information of the header encapsulated in the header object. Note that many of the headers are optional, and to relflect this they are returned as utils::Optional types. To use such a variable you must check it is valid first like this: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>(header.telescope_id().is_set()) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;telescope_id=&quot;</span> &lt;&lt; *header.telescope_id() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>We can put in some checks to see it is the data we are expecting. </p><div class="fragment"><div class="line"><span class="comment">// check header is what we are expecting</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="keywordflow">if</span>( header.data_type() != astro::sigproc::Header::DataType::FilterBank <span class="comment">// FilterBank file</span></div>
<div class="line">    &amp;&amp; header.number_of_bits() != 16                                   <span class="comment">// 16 bit data</span></div>
<div class="line">    &amp;&amp; header.number_of_number_of_nifs() != 1                          <span class="comment">// Stokes I only</span></div>
<div class="line">   )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;unexpected file format&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Our next task is to read in the data into a suitable data structure. We do this using the SigProcFormat templated Adapter. The template arguments must be consistent with the header.data_type(). The code below will read if FilterBank types. Swap the template parameters if this is TimeSeries data.</p>
<div class="fragment"><div class="line">astro::DimensionSize&lt;astro::units::Frequency&gt; chunk_size(1000); <span class="comment">// a thousand samples at a time</span></div>
<div class="line">astro::TimeFrequency&lt;uint16_t&gt; data(header.number_of_channels(), chunk_size);</div>
<div class="line"><span class="keywordflow">while</span>(!in.eof()) {</div>
<div class="line">    in &gt;&gt; SigProcFormat&lt;astro::units::Time, astro::units::Frequency&gt;() &gt;&gt; data;</div>
<div class="line">    do_something_with_the_data(data);</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can also write out to a std::ostream using the same SigProcFormat class. </p><div class="fragment"><div class="line"><span class="comment">// e.g. where header data_type is FilterBank</span></div>
<div class="line">std::ofstream out(<span class="stringliteral">&quot;output_data.fil&quot;</span>);</div>
<div class="line">out &lt;&lt; header;</div>
<div class="line">out &lt;&lt; SigProcFormat&lt;astro::units::Time, astro::units::Frequency&gt;() &lt;&lt; data;</div>
</div><!-- fragment --><h2>More Generic Applications</h2>
<p>If you are writing an application that needs to handle all types of sigproc files then you will need to generate code for each different possibilty. This is because our TimeFrequency data types do not, for reasons of runtime speed, inherit from a common base class.</p>
<p>Fortunately this is easier than it sounds. astrotypes::sigproc provides helpers to do this for you and all you need to do is provide a template class for your code. See the <a class="el" href="sigproc__cat_8cpp.html">sigproc_cat.cpp</a> in the examples directory.</p>
<div class="fragment"></div><!-- fragment --><h2>Non-Standard Sigproc Headers</h2>
<p>The Sigproc format has been much abused, and people have added many non-standard headers. A limited format such as sigproc cannot handle this in a generic way, and so if you need to read in such custom files you will need to create your own header class. To do so just inherit from the <a class="el" href="classpss_1_1astrotypes_1_1sigproc_1_1Header.html" title="Store SigProc header information. ">pss::astrotypes::sigproc::Header</a> as in the example&gt; </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 13 2019 10:23:00 for astrotypes by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
